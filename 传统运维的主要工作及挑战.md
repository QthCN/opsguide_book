# 传统运维的主要工作及挑战

由于读者目前可能不是从事运维相关工作，或者说大部分运维只是聚焦于某个运维领域而不熟悉其它的领域，因此本章会介绍一下传统运维的主要工作。虽然笔者在这里使用了*传统*一词，但其主要是为了和*自动化、平台化*的运维做区分，其并不代表传统的运维的内容和自动化的运维存在多大的差异。

笔者写了一个爬虫脚本[ops_job_crawler.py](https://github.com/opsguide/scripts/blob/master/ops_job_crawler.py)，用于抓取某个招聘网站上运维相关的职位要求及职位名称，然后通过分词脚本[fenci.py](https://github.com/opsguide/scripts/blob/master/fenci.py)处理后整理出了这个招聘网站上对于运维职业的要求。按照出现频率排序后的内容为：

关键字|出现个数|关键字|出现个数
-----|------|-----|------
维护|3301|网络|2730
数据库|2440|安全|2102
服务器|1549|配置|1416
优化|1309|Linux|1308
安装|1199|监控|1150
开发|1133|故障|1094
实施|871|网络安全|862
性能|747|平台|723
架构|719|部署|717
操作系统|705|MySQL|575
网络设备|545|责任心|543
SQL|534|备份|523
文档|515|防火墙|471
意识|470|路由器|449
交换机|448|信息安全|439
调优|423|硬件|414
存储|398|IDC|398
流程|367|Windows|364
协议|358|脚本|343
解决方案|315|自动化|293

从这个抓取结果大致可以看到，运维的工作要求排在最前面的几项是维护、网络、数据库、安全、服务器以及配置。不难想象很多运维的日常工作就是和网络、数据库、服务器打交道。例如一个系统PE一天的工作可能就是部署新的服务器(包括布线、上架、安装操作系统等等)，而一个DBA的日常工作可能就是处理开发提交过来的SQL，或者是对数据库出现的告警进行处理。我们可以看到『配置』排的比较靠前，一般运维对中间件、数据库等都需要进行配置，另外对服务器上的文件目录结构、中间件的参数也都要进行配置。除了这些关键字外，从这个表格中我们可以看到运维需要对其维护的系统有『优化』的能力，例如某个集群出现了性能瓶颈，用户打开一个页面需要好几秒，那么这个时候运维就需要去查看相关的服务器性能、网络性能等等，并和开发一起进行优化。优化的方式有很多，例如是不是要考虑用CDN、加Cache，是不是要考虑加个索引等等。同时从表格中我们发现对于运维来说，熟悉Linux、MySQL是很重要的，这一点和笔者的实际工作经验比较吻合。在继续看这个表格，接下来出现了『开发』、『脚本』、『自动化』等关键字，这个是目前的一个趋势，也是本书的目的之一，就是运维一定要具有开发能力，一定要让手工的重复劳动通过自动化的工具、平台进行替代。除了这些『技术』相关的关键字外，我们还能从这个表中看到『责任心』、『意识』这类关键字。『责任心』对于运维来说是很重要的，毕竟一个疏忽可能就会造成巨大的损失，而具有『意识』的运维人员则能敏锐的感知到运维行业所进行的变化，并具备一定的『架构』能力，其能抓住机会提升其所在团队的运维层次。

结合这个表格并加上笔者的工作经验来说，归纳下传统运维的主要工作就是：

* 对数据库、中间件、服务器、网络等进行部署、维护
* 对日常出现的性能问题、故障进行优化、排查
* 对未来系统的容量进行预估，对资源进行扩容、调整
* 设计合理的架构，满足业务的需要

同时，如果一个公司的运维部门具备了自动化运维的意识，那么其日常的主要工作笔者认为还需要加上：

* 通过自动化的工具、平台减少日常繁琐的人工工作，缩短需求方和资源之间的距离
* 运维的一大半时间用于运维平台的管理、开发，而运维平台则会减少用于传统运维操作的时间

举个例子说明下目前一个传统PE的一天。

假设你就是这个PE，早上上班，打开邮件，发现一连串的未读邮件。其中有一封开发发来的要求申请新服务器的邮件用于新业务上线，你想了想这个业务之前评估过，只需要4台服务器就可以了，但开发申请了8台，因此你回绝了他的请求。还有一封邮件是审计部门发来的，要求你提供服务器上所有用户的权限信息，于是你登陆服务器，拉取信息，把数据贴到Excel中，手工加工后发还给了审计部门。接下来还有一些邮件是关于告警的，有些是关于磁盘空间不足的，有些是关于内存不足的。在把这些邮件都处理完后，你开始为某个业务的上线进行主机的分配，主要是虚拟机的分配，但由于申请的主机台数较多，且对操作系统版本、网段等要求比较繁杂，因此这个消耗了你不少时间。等这些做的差不多后你收到了配管发来的邮件，列出了这周要上线的业务的新版本，其中有一些要提前部署预发环境，于是你和配管沟通，拿到要部署的war包，在确认测试已经测试过这些代码后你进行了预发环境的部署。等这些都差不多后你会发现现在已经是晚上九点了。于是你打算下班，走之前最后看了眼邮件，发现又有一堆未读邮件，内容包括新硬件的测试及采购、来年服务器的采购预算规划、某个安全部门发来的JBoss高危漏洞修复请求等等，好在大部分邮件都已经处理了，这些事情就留给明天再做吧。当你合上笔记本打算离开公司时你接到了电话，今天上线的预发版本有问题需要紧急回滚，于是你又打开笔记本，一边骂着开发、测试不靠谱，一边取新的war包，拷贝到服务器，切换F5、重启JBoss。晚上你在家中睡的正香，突然被电话吵醒，有个业务无法访问的一级告警，于是你立刻从床上爬起来，连上VPN进行处理，通过排查发现表面原因是某个主机CPU使用率过高引起的，你怀疑是某个SQL造成的，于是你电话叫起了DBA一起排查，但由于短时间内无法确定根本原因，于是你决定迁移这个应用到其它主机上，迁移消耗了你不少时间。等这个问题解决后天也差不多亮了。于是你第二天的上午半天你在家休息，等你下午来到公司打开电脑的时候发现你的邮件中又积累了一大堆需要你处理的邮件...

对于没有做过运维的读者来说，上面的这个例子可能有些夸张，但笔者想说的是现实可能更加的*残酷*。当公司的业务用户量到达一个级别，公司的主机数目到达一个级别，公司的业务类型到达一个级别的时候，传统运维就会遇到『时间不够用』的情况。

本书的目的就是向读者普及运维自动化，告知读者如今的一些运维相关技术的原理、实现，并会开发一个完整的运维自动化平台，这样对于主机资源申请、用户权限数据拉取等操作就可以让需求方自己登陆平台处理了。

在本书的第二部分中会先介绍一下现在比较流行的运维自动化的平台及思想，在第二部分中的介绍会偏向于从大局的方面介绍，而在后续的第三、第四部分中的每一章节都会对特定部分进行详细的介绍。在第二部分的最后我们会开始设计及开发我们的运维自动化系统，然后在后面的每一章我们都会对这个自动化系统的特定方面进行优化。

在我们进入下面的章节开发我们的运维自动化系统之前笔者必须再强调一个问题，那就是在笔者工作的这些时间里发现很多人都犯过一个错误（包括笔者自己）：我们做运维自动化系统的目的是什么？一些人的做运维自动化系统的原因是大家都在做，因此他们也要做，还有一些人的目的是为了KPI而做。其实运维的根本目的是为了支撑业务的健康发展。如果说当前通过vSphere的一套已经可以满足公司目前的业务，并且接下来几年都不会出现明显的瓶颈（例如这个公司一共就8台物理机，业务量增长的情况下接下来3年最多扩展到16台物理机），那么是否有必要自己去搭建一个私有云环境？毕竟私有云需要运维人员具备更加强的运维能力，而vSphere出了问题原厂是能及时提供帮助的，简单的说就是出了问题后，哪种方式能最大的减少业务不可用的时间。因此大家在决定是否在生成环境使用新技术，在设计运维自动化系统的时候必须记住，这些技术、平台的根本用处是为了支持业务。如果新的技术能更好的支持业务，且能降低维护成本进而降低人工成本、软硬件成本，并且公司的运维团队有足够的能力保证其可靠稳定，那么可以积极的去考虑将它落地。如果新的技术和旧的技术相比有一定优势，但缺乏其在真实生产环境中的用例，且文档不完善、自身处于快速的开发迭代中，那么就需要评估下公司内部运维的能力，量力而行。

对于本书所开发的自动化系统，如果读者完整的理解了本书的内容的话，那么相信读者是有对该系统的完全掌控能力的。任何系统都有其设计原则，本书设计的自动化系统的设计原则为：

* 简单。简单的系统便于维护，这一点在我们设计系统进行功能取舍的时候特别重要
* 自助。让开发直接面对资源，减少开发到资源的路径
* 自动。减少运维人员的工作负担，系统能自主处理的问题交给系统处理
* 数据。系统的资源使用信息、故障信息等都要有详细的记录
* 稳定。系统运行稳定，不存在单点问题
* 性能。系统有能力处理较大规模集群的运维自动化管理
